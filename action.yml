name: "aws-ec2"
description: "transfer file from local to Ec2"

on:
  workflow_dispatch:

inputs:
    name:
        description: "name of the file"
        required: true
    source:
        description: "path in the repository"
        required: true
    destination:
        description: "instance path"
        required: true
    instance_ip:
        description: "EC2 Instance IP address"
        required: true
    ssh_key:
        description: "SSH private key for accessing the EC2 instance"
        required: true

jobs:
  transfer_file:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Copy file to EC2 instance
        env:
          EC2_INSTANCE_IP: ${{ inputs.instance_ip }}
          SSH_KEY: ${{ inputs.ssh_key }}
          SOURCE_PATH: ${{ inputs.source }}
          DESTINATION_PATH: ${{ inputs.destination }}
        run: |
          # Create the SSH key directory
          mkdir -p ~/.ssh
          # Save the SSH key
          echo "${SSH_KEY}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          
          # Copy the file to the EC2 instance
          scp -o StrictHostKeyChecking=no -i ~/.ssh/id_rsa $SOURCE_PATH ec2-user@$EC2_INSTANCE_IP:$DESTINATION_PATH
  